%! TeX program = lualatex
% - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
% Core setup
% - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
\documentclass[10pt,a4paper]{article}
\usepackage[tmargin=2.5cm,rmargin=2.5cm,bmargin=2.5cm,lmargin=2.5cm]{geometry}
\usepackage[norsk]{babel}         % Support for other languages than english
\usepackage[utf8]{inputenc}       % Input encoding
\usepackage[T1]{fontenc}          % Font encoding
\usepackage{microtype}            % Improve text appearance in numerous ways
\usepackage{textcomp}             % Add extra symbols
\usepackage{mathtools}            % Improvements for math
\usepackage{amssymb}              % Extended math symbols


% - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
% Font packages
% - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
%\usepackage[p,osf]{fbb}          % Main font
%\usepackage[scaled=.95,type1]{cabin} % Sans-serif font
%\usepackage[libertine]{newtxmath} % Math font
\usepackage[osf]{newpxtext}       % Main (serif/sans-serif) font
\usepackage{newpxmath}            % Math font
\usepackage[scaled]{beramono}     % Monospace font
\usepackage{iftex}
\ifLuaTeX
    \usepackage{fontspec}                % Custom fonts
    \setmonofont{PxPlus ToshibaSat 8x16} % Override monospace font
\fi


% - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
% Additional packages
% - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
\usepackage{soul}                 % Character spacing
\usepackage[T1]{url}              % Clickable URLs
\usepackage{hyperref}             % Clickable references
\usepackage{csquotes}             % Support quote marks in various languages
\usepackage{ulem}                 % Double underline
\usepackage[makeroom]{cancel}     % Crossing out text
\usepackage{nicefrac}             % Nice looking fractals
\usepackage{gensymb}              % Degree symbol
\usepackage[compact]{titlesec}    % Title style
\usepackage{setspace}             % Set paragraph spacing
\usepackage{xcolor}               % Colors
\usepackage{enumitem}             % Lists
\usepackage{listings}             % Insert code
\usepackage{tikz}                 % Drawing of graphics
\usepackage{graphicx}             % Insert images
\usepackage{pdfpages}             % Insert pdf pages
\usepackage{biblatex}             % Bibliography


% - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
% Include files
% - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
\include{er}


% - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
% Apprentice colorscheme (https://github.com/romainl/Apprentice)
% - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
\definecolor{color0}{HTML}{1C1C1C}
\definecolor{color1}{HTML}{AF5F5F}
\definecolor{color2}{HTML}{5F875F}
\definecolor{color3}{HTML}{87875F}
\definecolor{color4}{HTML}{5F87AF}
\definecolor{color5}{HTML}{5F5F87}
\definecolor{color6}{HTML}{5F8787}
\definecolor{color7}{HTML}{6C6C6C}
\definecolor{color8}{HTML}{444444}
\definecolor{color9}{HTML}{FF8700}
\definecolor{color10}{HTML}{87AF87}
\definecolor{color11}{HTML}{FFFFAF}
\definecolor{color12}{HTML}{87AFD7}
\definecolor{color13}{HTML}{8787AF}
\definecolor{color14}{HTML}{5FAFAF}
\definecolor{color15}{HTML}{FFFFFF}
\definecolor{colorfg}{HTML}{BCBCBC}
\definecolor{colorbg}{HTML}{262626}


% - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
% Habamax colorscheme (https://github.com/habamax/vim-habamax)
% - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
\definecolor{brightCyan}{HTML}{87AFAF}
\definecolor{cyan}{HTML}{5F8787}
\definecolor{darkCyan}{HTML}{1F3F5F}
\definecolor{pink}{HTML}{D75F87}
\definecolor{red}{HTML}{D75F5F}
\definecolor{darkRed}{HTML}{AF5F5F}
\definecolor{brightGreen}{HTML}{5FF75F}
\definecolor{green}{HTML}{87D787}
\definecolor{darkGreen}{HTML}{5FAF5F}
\definecolor{blue}{HTML}{5fafd7}
\definecolor{darkBlue}{HTML}{5F87AF}
\definecolor{brightYellow}{HTML}{ffaf5f}
\definecolor{yellow}{HTML}{d7af87}
\definecolor{darkYellow}{HTML}{af875f}
\definecolor{brightMagenta}{HTML}{ff00af}
\definecolor{magenta}{HTML}{d787d7}
\definecolor{darkMagenta}{HTML}{af87af}


% - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
% Custom commands
% - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
%\sodef\allcapsspacing{\upshape}{0.15em}{0.65em}{0.6em}
%\sodef\lowsmallcapsspacing{\scshape}{0.075em}{0.5em}{0.6em}
%\newcommand{\allcaps}[1]{\MakeUppercase{\allcapsspacing{#1}}}%   
%\newcommand{\smallcaps}[1]{\MakeLowercase{\textsc{\lowsmallcapsspacing{#1}}}}
\newcommand{\oppgave}[1]{\subsection*{Oppgave #1}}
\newcommand{\oppgaveDelStart}{\begin{enumerate}[leftmargin=*,itemsep=1.5cm,labelsep=1.5em,label=\alph*)]}
\newcommand{\oppgaveDelSlutt}{\end{enumerate}}
\newcommand{\oppgaveDel}[1]{\item[\textbf{#1})]}


% - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
% Package settings
% - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
\usetikzlibrary{shapes.multipart,shadows}
\usetikzlibrary{positioning}
\usetikzlibrary{calc}
\color{color0}
\linespread{1.05}
\setlength{\parindent}{0pt}
%\setlength{\tabcolsep}{18pt}
%\renewcommand{\arraystretch}{1.25}
\newlength{\myeqskip}\setlength{\myeqskip}{2pt}
\titlespacing*{\section}{0cm}{1.5cm}{0.25cm}
\titlespacing*{\subsection}{0cm}{1cm}{0.5cm}
\titleformat{\section}{\normalfont\large\bfseries}{\thesection}{0.75em}{}
\titleformat{\subsection}{\normalfont\normalsize\bfseries}{\thesubsection.}{0.75em}{}
\titleformat{\subsubsection}{\normalfont\normalsize\itshape}{\thesubsubsection.}{0.75em}{}
\lstset{literate={æ}{{\ae}}1{Æ}{{\AE}}1{ø}{{\o}}1{Ø}{{\O}}1{å}{{\aa}}1{Å}{{\AA}}1,
keywordstyle={\bfseries\color{color1}}, 
commentstyle={\bfseries\color{cyan}},
basicstyle={\scriptsize\ttfamily\color{color0}}, 
numbers=none,numberstyle={\scriptsize\ttfamily\color{color7}},
aboveskip=1cm,belowskip=1cm,columns=fixed,
breaklines=true,breakatwhitespace=false,keepspaces=true,
showspaces=false,showstringspaces=false,tabsize=4,
captionpos=b,inputencoding=utf8,extendedchars=true}
\tikzstyle{every pic} = [draw=color8]
\tikzstyle{every edge} = [semithick, draw=color8]


% - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
% Set title / author
% - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
\title{DAT107 \textendash \ Obligatorisk innlevering 2}
\author{\normalsize Gruppemedlemmer: \\ Stephen Neba Fuh, Tord Johan Melheim, \\ Ebubekir Siddik Yuksel, Casper Eide Özdemir-Børretzen}
\date{}


% - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
% Document start and title page
% - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
\begin{document}
\maketitle


% - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
% Todo-list
% - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
%\begin{lstlisting}[language=SQL]
%\end{lstlisting}
%\lstinputlisting[language=SQL]{file.sql}
%\oppgave{1}
%\oppgaveDelStart
%\oppgaveDel{a}
%\oppgaveDel{b}
%\oppgaveDel{c}
%\oppgaveDelSlutt

% Huskeliste:
% Primærnøkler
% Fremmednøkler
% Datatyper
% Min/maks kadinalitet
% Sterke/svake entitetstyper og eksistensavhengighet/uavhengighet (kråkefot-notasjon) eller type aggregering (UML-notasjon)
% Redegjørelse/forklaring på at ER-modellen tilfredsstiller hver av 1., 2., og 3. normalform. Tabellene skal faktisk være korrekt normaliserte – det holder ikke å hevde at de er normaliserte dersom de ikke er det.
% Redegjørelse for de valgene som er tatt. Det blir lagt vekt på både praktisk utførelse og teoretisk forståelse
% Besvarelsen skal være “konsistent”, dvs. skal være for den “samme” databasen, og de valgene man har tatt i en del av besvarelsen skal ikke “motsies” av de valgene man har tatt i en annen del av besvarelsen.


% - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
% Main content
% - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
\section{Introduksjon}

En forening har behov for et system for å administrere medlemmer. Det er tenkt å ta i bruk en SQL database for å bygge dette systemet.
Foreningen har flere lokallag, og alle medlemmer er med i nøyaktiv ett lokallag.
Lokallag har navn, leder (medlem), samt postnummer/sted og gatenavn/husnummer for møtelokale.
Et medlem har medlemsnummer, fornavn, etternavn, telefonnummer, e-postadresse, postnummer/sted, gatenavn/husnummer, og medlemsstatus (aktiv/utmeldt).
For hvert medlem skal det i tillegg loggføres om medlemsavgift hare blitt betalt for hvert år.\\

Oppgaven vi skal ta for oss er å tegne en logisk (fullstendig) ER-modell i kråkefot-notasjon for en SQL database som fyller kravene spesifisert i problemstillingen, samt å vise at modellen tilfredsstiller 3. normalform.
Tegningen skal inneholde primærnøkler, fremmednøkler, datatyper, min/maks kardinalitet, sterke/svake entitetstyper og eksistensavhengighet/uavhengighet.

\section{Metode}

Vi starter med en felles diskusjon for hvordan vi ser for oss databasedesignet, for så å tegne en grov skisse av ER-modellen på whiteboard. Denne whiteboard-skissen tar vi bilde av for senere bruk.
Videre vil vi prøve å ta i bruk LaTeX-pakken TikZ for å utarbeide vår egen måte å tegne ER-diagram i kråkefot-notasjon på som tilfredsstiller alle oppgavekravene.
Vi ser for oss å bruke kode publisert på LaTeX Stack Exchange av AndréC\footnote{AndréC. (2018, 9. desember). \textit{How to create an ER diagram using tikzpicture environment}. LaTex Stack Exchange. \url{https://tex.stackexchange.com/questions/462914/how-to-create-an-er-diagram-using-tikzpicture-environment/463912#463912}} som utganspunkt for vår implementasjon.
Etter at vi har utarbeidet en egnet metode for ER-diagram tegning, blir neste steg å overføre whiteboard tegningen fra tidligere til LaTeX.
Når den endelige tegningen er ferdigstilt blir siste steg å skrive SQL spørringer for oppretting av databasen, samt å ta i bruk LaTeX-pakken listings for å legge ved SQL spørringer i den ferdige oppgaven. SQL spørringene tester vi underveis ved bruk av det konsollbaserte programmet psql og en skybasert PostgreSQL database der vi har fått tildelt en brukerkonto fra HVL.

%\vspace{0.5cm}
%\begin{tabular}{|c|c|c|} 
%\hline
%&Fordel&Ulempe \\
%\hline
%    a&b&c\\
%    a&b&c\\
%    a&b&c\\
%\hline
%\end{tabular}

\section{Resultat}

TODO: Beskriv resultatet på deloppgavene etter å ha benyttet metodene

\begin{center}
\begin{tikzpicture}

% Medlem
\pic {entity={m}{Medlem}{
CHAR(5)     & MedlemsNr (\textcolor{color1}{PK})\\
VARCHAR(35) & LagNavn (\textcolor{color1}{FK})\\
BOOLEAN     & Aktiv \\
VARCHAR(35) & Fornavn \\
VARCHAR(35) & Etternavn \\
VARCHAR(25) & Telefonnummer \\
VARCHAR(50) & Epost \\
CHAR(4)     & PostNr (\textcolor{color1}{FK})\\
VARCHAR(50) & Adresse
}};

% Lag
\pic[right = 10em of m] {entity={l}{Lokallag}{
VARCHAR(35) & LagNavn (\textcolor{color1}{PK})\\
CHAR(5)     & LederNr (\textcolor{color1}{FK})\\
CHAR(4)     & PostNr (\textcolor{color1}{FK})\\
VARCHAR(50) & Adresse
}};

% Medlemsavgift
\pic[below = 10em of $(m)!0.5!(l)$] {weak entity={a}{Medlemsavgift}{
CHAR(5)     & MedlemsNr (\textcolor{color1}{PK, FK})\\
DATE        & Aar (\textcolor{color1}{PK})
}};

% Poststed
\pic[above = 10.5em of $(m)!0.5!(l)$] {entity={p}{Poststed}{
CHAR(4)     & PostNr (\textcolor{color1}{PK})\\
VARCHAR(35) & PostSted
}};

% Forhold
\draw[oone - mone] (m) edge  (l);
\draw[omany - mone] (a.north) |- ($(a.north) + (0,1)$) -| (m.south);
\draw[mone - omany, loosely dashed] (p.south) |- ($(p.south) - (0,1)$) -|  (l.north);
\draw[mone - omany, loosely dashed] (p.south) |- ($(p.south) - (0,1)$) -|  (m.north);

% Forklaring
%\draw (m) -- (l) node [midway, fill=white, font=\scriptsize\ttfamily] {tilhører}
\end{tikzpicture}
\end{center}

\vspace{0.5cm}

\begin{center}
\begin{tabular}{c}
\begin{lstlisting}[language=SQL]
-- Slett tabeller hvis de allerede eksisterer
DROP TABLE IF EXISTS Poststed, Lokallag, Medlem, Medlemsavgift;

-- Oppretting av tabellen Poststed
CREATE TABLE Poststed(
    PostNr        CHAR(4)     PRIMARY KEY,
    PostSted      VARCHAR(35) NOT NULL
);

-- Oppretting av tabellen Lokallag
CREATE TABLE Lokallag(
    LagNavn       VARCHAR(35) PRIMARY KEY,
    LederNr       CHAR(5),
    PostNr        CHAR(4),
    Adresse       VARCHAR(50)
);

-- Oppretting av tabellen Medlem
CREATE TABLE Medlem(
    MedlemsNr     CHAR(5)     PRIMARY KEY,
    LagNavn       VARCHAR(35) NOT NULL,
    Aktiv         BOOLEAN     NOT NULL,
    Fornavn       VARCHAR(35) NOT NULL,
    Etternavn     VARCHAR(35) NOT NULL,
    Telefonnummer VARCHAR(25),
    Epost         VARCHAR(50),
    PostNr        CHAR(4),
    Adresse       VARCHAR(50)
);

-- Oppretting av tabellen Medlemsavgift
CREATE TABLE Medlemsavgift(
    MedlemsNr     CHAR(5),
    Aar           DATE,
    PRIMARY KEY(MedlemsNr, Aar)
);

-- Oppsett av fremmednøkler for tabellen Lokallag
ALTER TABLE Lokallag
    ADD CONSTRAINT FN_LederNr FOREIGN KEY(LederNr) REFERENCES Medlem(MedlemsNr),
    ADD CONSTRAINT FN_PostNr FOREIGN KEY(PostNr) REFERENCES poststed(PostNr);

-- Oppsett av fremmednøkler for tabellen Medlem 
ALTER TABLE Medlem
    ADD CONSTRAINT FN_LagNavn FOREIGN KEY(LagNavn) REFERENCES Lokallag(LagNavn),
    ADD CONSTRAINT FN_PostNr FOREIGN KEY(PostNr) REFERENCES poststed(PostNr);
\end{lstlisting}
\end{tabular}
\end{center}

\section{Diskusjon}
TODO: Oppsummer resultatene, funnene og vurderingene


% - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 

\end{document}
